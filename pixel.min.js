// prettier-ignore
(function(){const script=document.getElementById("pixel-js");const pid=script.getAttribute("data-pid");const domain=window.location.hostname;const functionUrl="https://us-central1-visitorfit.cloudfunctions.net/handlePixelData";function getVisitorData(){return{pid:pid,domain:domain,path:window.location.pathname,isTest:new URLSearchParams(window.location.search).get("test")==="true",referrer:document.referrer,userAgent:navigator.userAgent,language:navigator.language,screenResolution:`${window.screen.width}x${window.screen.height}`,timestamp:(new Date).toISOString(),pageTitle:document.title,utmSource:new URLSearchParams(window.location.search).get("utm_source"),utmMedium:new URLSearchParams(window.location.search).get("utm_medium"),utmCampaign:new URLSearchParams(window.location.search).get("utm_campaign")}}function trackVisit(){console.log('ðŸ” Tracking visit initiated');const data=getVisitorData();if(data.isTest){console.log("Test mode enabled - sending data:",data)}fetch(functionUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(()=>console.log('âœ… Tracking data sent successfully')).catch(error=>{console.error("âŒ Error sending tracking data:",error)})}if(document.readyState==="complete"){trackVisit()}else{window.addEventListener("load",trackVisit)}let lastPath=window.location.pathname;let lastUrl = window.location.href;const observer=new MutationObserver(()=>{const currentPath=window.location.pathname;const currentUrl = window.location.href;const isTest = new URLSearchParams(window.location.search).get("test") === "true";if(currentPath!==lastPath){console.log('ðŸ“ Path changed:',currentPath);lastPath=currentPath;trackVisit()}if(currentUrl !== lastUrl){console.log('ðŸ“ URL changed:', currentUrl);lastUrl = currentUrl;if(isTest){console.log('ðŸ§ª Test parameter detected, tracking visit');trackVisit()}}});observer.observe(document.documentElement,{subtree:true,childList:true});window.addEventListener("beforeunload",()=>{console.log('ðŸ‘‹ Page exit tracking');const data=Object.assign({},getVisitorData(),{event:"page_exit",timeSpent:(new Date-performance.timing.navigationStart)/1e3});navigator.sendBeacon(functionUrl,JSON.stringify(data))})})();
